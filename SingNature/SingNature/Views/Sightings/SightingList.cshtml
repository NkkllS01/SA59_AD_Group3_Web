@model SightingListViewModel

@{
    ViewData["Title"] = "Sightings List";
}

<head>
    <link rel="stylesheet" type="text/css" href="~/css/index.css" asp-append-version="true" />
</head>

<h2>Sightings List</h2>

<table class="table table-bordered" id="sightingsTable">
    <thead>
        <tr>
            <th>Sighting ID</th>
            <th>User Name</th>
            <th>Date</th>
            <th>Specie Name</th>
            <th>Details</th>
            <th>Image</th>
            <th>Location</th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be loaded here dynamically -->
    </tbody>
</table>

<!-- JavaScript to Call API and Populate Table -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        fetch("/api/sightings")  // Call the API route
            .then(response => response.json())
            .then(data => {
                let tableBody = document.querySelector("#sightingsTable tbody");
                tableBody.innerHTML = ""; // Clear previous data

                data.forEach(sighting => {
                    let row = `<tr>
                        <td>${sighting.sightingId}</td>
                        <td>${sighting.userName}</td>
                        <td>${new Date(sighting.date).toLocaleString()}</td>
                        <td>${sighting.specieName}</td>
                        <td>${sighting.details || ""}</td>
                        <td>${sighting.imageUrl ? `<img src="${sighting.imageUrl}" width="100" height="100">` : "No Image"}</td>
                        <td>Lat: ${sighting.latitude}, Lng: ${sighting.longitude}</td>
                    </tr>`;
                    tableBody.innerHTML += row;
                });
            })
            .catch(error => console.error("Error fetching sightings:", error));
    });
</script>